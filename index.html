<!doctype html>
<html lang="en">
  <head>
    <link rel="manifest" href="/site.webmanifest" />
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="theme-color" content="#282828" />
    <title>WebRTC Peer2Peer Connection</title>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <link
      rel="icon"
      type="image/png"
      sizes="32x32"
      href="/favicon_io/favicon-32x32.png"
    />
    <link
      rel="apple-touch-icon"
      type=""
      href="/favicon_io/apple-touch-icon.png"
    />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta
      name="apple-mobile-web-app-status-bar-style"
      content="black-translucent"
    />
    <style>
      @layer base {
        * {
          box-sizing: border-box;
          margin: 0;
          padding: 0;
          font-family:
            monospace,
            -apple-system,
            system-ui,
            blinkmacsystemfont,
            "segoe ui",
            roboto,
            oxygen,
            ubuntu,
            cantarell,
            "open sans",
            "helvetica neue",
            sans-serif;
        }
      }

      .file-input {
        position: absolute;
        width: 1px;
        height: 1px;
        padding: 0;
        margin: -1px;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        white-space: nowrap;
        border: 0;
      }

      .animate-bounce-2 {
        animation: bounce 1s ease-in infinite;
        animation-iteration-count: 2;
      }

      @keyframes bounce {
        0%,
        100% {
          transform: translateY(-0%);
        }
        50% {
          transform: translateY(-10px);
        }
      }

      @keyframes sonar {
        0% {
          transform: scale(0.35);
          opacity: 0.8;
        }

        100% {
          transform: scale(2.4);
          opacity: 0;
        }
      }

      @keyframes float {
        0%,
        100% {
          transform: translateY(0);
        }

        50% {
          transform: translateY(-5px);
        }
      }

      @keyframes pop {
        0% {
          transform: scale(0.5);
          opacity: 0;
        }

        70% {
          transform: scale(1.08);
        }

        100% {
          transform: scale(1);
          opacity: 1;
        }
      }

      .peer-item:hover {
        transform: scale(1.05);
      }

      .peer-item {
        width: 80px;
        height: 80px;
        border-radius: 50%;
        background: #458588;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        text-align: center;
        padding: 8px;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
        cursor: pointer;
        transition: all 0.2s ease;
        overflow: hidden;
        outline: 2px dashed #d79921;
        outline-offset: 6px;

        position: relative;
        overflow: hidden;
        animation:
          float 3s ease-in-out infinite,
          pop 0.6s ease-out backwards;
      }

      .peer-name,
      .peer-id {
        font-size: 0.65rem;
        line-height: 1.2;
        color: white;
        width: 100%;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
      }

      .peer-item::before {
        content: "";
        position: absolute;
        inset: 0;
        border-radius: 50%;
        border: 2px solid #d79921;
        animation: sonar 2.2s ease-out infinite;
      }

      .peer-item.selected {
        animation-duration: 0.8s, 0.6s;
      }

      .peer-item:hover::before {
        animation-play-state: paused;
      }

      @keyframes dot {
        0%,
        20% {
          opacity: 0;
        }
        50% {
          opacity: 1;
        }
        100% {
          opacity: 0;
        }
      }

      .peers-list.empty-state .message::after {
        content: "";
        display: inline-block;
        width: 6px;
        height: 6px;
        margin-left: 6px;
        background: #d79921;
        border-radius: 50%;
        animation: dot 1.4s infinite;
      }

      @media (min-width: 640px) {
        .peer-item {
          width: 90px;
          height: 90px;
          outline-offset: 7px;
        }
      }

      @media (min-width: 768px) {
        .peer-item {
          width: 100px;
          height: 100px;
          outline-offset: 8px;
        }
      }

      @media (min-width: 768px) {
        .peer-name,
        .peer-id {
          font-size: 0.75rem;
        }
      }

      .peer-name {
        font-weight: bold;
        margin-bottom: 2px;
      }

      .peer-item:hover {
        outline: 2px solid #d79921;
        background: #076678;
      }

      .peer-item.selected {
        background: rgba(76, 175, 80, 0.4);
        border: 2px solid #4caf50;
        transform: scale(1.05);
      }

      .peers-list.empty-state {
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
      }

      .peers-list.empty-state .message {
        color: #aaa;
        font-style: italic;
        text-align: center;
        padding: 20px;
      }

      .file-input-label:hover {
        background: black;
        border-color: #3c7d7f;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      }

      #status-bar {
        background: #282828;
      }

      .status-value.connected {
        color: #98971a !important;
      }

      .status-value.disconnected {
        color: #cc214d !important;
      }

      .log-warning {
        color: #ff9800;
      }

      .log-error {
        color: #f44336;
      }
    </style>
  </head>

  <body class="bg-[#282828] text-white min-h-screen p-4 md:p-6 lg:p-8">
    <div
      id="notify"
      class="hidden text-[#83a598] absolute bg-[#282828] animate-bounce-2 top-5 left-5 border-2 border-solid border-[#cc241d] p-2"
    >
      <span class="text-[#cc241d]">● </span>Starting up... This may take a few
      seconds on first launch.
    </div>
    <div
      id="share-modal"
      class="hidden fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-4"
    >
      <div
        class="bg-[#282828] border border-[#3c3836] rounded-lg p-6 w-full max-w-md mx-4"
      >
        <div class="flex justify-center my-4">
          <div
            id="qr-code"
            class="bg-[#3c3836] border border-[#504945] w-48 h-48 flex items-center justify-center"
          ></div>
        </div>

        <div class="mt-4">
          <label class="block text-[#a89984] text-sm mb-1">Room ID</label>
          <div
            id="room-id"
            class="text-[#ebdbb2] bg-[#3c3836] p-2 rounded font-mono text-center break-all text-sm"
          ></div>
        </div>

        <div class="mt-5">
          <button
            id="copy-url-btn"
            class="w-full bg-[#3c3836] hover:bg-[#504945] text-[#83a598] py-2 rounded text-sm font-medium transition focus:outline-none focus:ring-1 focus:ring-[#83a598]"
          >
            Copy Room URL
          </button>
        </div>
      </div>
    </div>

    <div
      id="join-room"
      class="min-h-screen text-[#ebdbb2] flex items-center justify-center p-6"
    >
      <div
        class="w-full max-w-md rounded-xl shadow-2xl bg-[#3c3836] border border-[#504945] p-8 space-y-6"
      >
        <div class="text-center">
          <h1 class="text-2xl font-bold text-[#fabd2f]">Start a secure call</h1>
          <p class="text-sm text-[#a89984] mt-1">
            One click and you’ll get a private room link to share.
          </p>
        </div>

        <button
          id="create-btn"
          class="w-full cursor-pointer flex items-center justify-center gap-3 bg-[#fe8019] hover:bg-[#fd9644] text-[#282828] font-semibold py-3 px-4 rounded-lg transition transform hover:scale-[1.02] focus:outline-none focus:ring-4 focus:ring-[#fe8019]/50"
        >
          <svg
            class="w-6 h-6"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M12 4v16m8-8H4"
            />
          </svg>
          Create room
        </button>

        <div
          class="flex items-center text-[#7c6f64] text-xs uppercase tracking-wider"
        >
          <span class="h-px bg-[#504945] flex-1"></span>
          <span class="px-3">or</span>
          <span class="h-px bg-[#504945] flex-1"></span>
        </div>

        <div class="space-y-3">
          <label for="roomCode" class="block text-sm font-medium text-[#b8bb26]"
            >Already have a code?</label
          >
          <div class="flex flex-col gap-3">
            <input
              id="roomCode"
              type="text"
              placeholder="a8f3k2z1"
              maxlength="8"
              class="flex-1 bg-[#282828] border border-[#504945] rounded-md px-4 py-2 text-[#ebdbb2] placeholder-[#7c6f64] focus:outline-none focus:ring-2 focus:ring-[#b8bb26]"
            />
            <button
              id="join-btn"
              class="bg-[#458588] cursor-pointer hover:bg-[#83a598] text-[#282828] font-semibold px-5 py-2 rounded-md transition"
            >
              Join
            </button>
          </div>
        </div>

        <p class="text-xs text-[#a89984] text-center">
          Rooms expire 30 min after everyone leaves.
        </p>
      </div>
    </div>

    <div
      id="main-ui"
      class="container hidden max-w-7xl mx-auto flex flex-col gap-4 md:gap-6"
    >
      <button
        id="share-btn"
        class="absolute top-5 right-5 bg-[#3c3836] hover:bg-[#504945] text-yellow-500 px-3 py-1.5 rounded text-sm font-medium transition shadow-[0_2px_4px_rgba(0,0,0,0.2)] focus:outline-none focus:ring-1 focus:ring-[#83a598]"
      >
        🔗 share room
      </button>

      <header class="text-center py-4 md:py-6">
        <h1
          class="text-3xl md:text-4xl lg:text-5xl font-bold mb-2 md:mb-3"
          style="color: #b8bb26; text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.6)"
        >
          peer-to-peer connection.
        </h1>
        <p
          class="subtitle text-base md:text-lg lg:text-xl"
          style="color: #8ec07c"
        >
          file & message share, directly
        </p>
      </header>

      <!-- Status Bar -->
      <div
        id="status-bar"
        class="status-bar md:hidden grid grid-cols-3 gap-3 text-[#ebdbb2] p-3 rounded-lg shadow-lg text-xs"
        style="background: #3c3836; border: 1px solid #504945"
      >
        <div class="status-item text-center">
          <div class="status-label opacity-70">WS</div>
          <div id="ws-status-m" class="status-value disconnected font-semibold">
            ●
          </div>
        </div>
        <div class="status-item text-center">
          <div class="status-label opacity-70">ID</div>
          <div id="my-id" class="status-value font-semibold">-</div>
        </div>
        <div class="status-item text-center">
          <div class="status-label opacity-70">DC</div>
          <div id="dc-status-m" class="status-value disconnected font-semibold">
            ●
          </div>
        </div>
      </div>
      <div
        class="status-bar hidden md:flex flex-wrap justify-between gap-3 text-[#ebdbb2] p-4 rounded-lg shadow-lg"
        style="background: #3c3836; border: 1px solid #504945"
      >
        <div class="status-item flex flex-col items-center min-w-[120px]">
          <div class="status-label text-sm opacity-80 mb-1">
            WebSocket Status
          </div>
          <div
            id="ws-status"
            class="status-value disconnected font-bold text-base"
            style="color: #cc241d"
          >
            Disconnected
          </div>
        </div>
        <div class="status-item flex flex-col items-center min-w-[120px]">
          <div class="status-label text-sm opacity-80 mb-1">Your ID</div>
          <div
            id="my-id"
            class="status-value font-bold text-base"
            style="color: #d79921"
          >
            Not registered
          </div>
        </div>
        <div class="status-item flex flex-col items-center min-w-[120px]">
          <div class="status-label text-sm opacity-80 mb-1">Your Name</div>
          <div
            id="my-name"
            class="status-value font-bold text-base"
            style="color: #d79921"
          >
            Not registered
          </div>
        </div>
        <div class="status-item flex flex-col items-center min-w-[120px]">
          <div class="status-label text-sm opacity-80 mb-1">Data Channel</div>
          <div
            id="dc-status"
            class="status-value disconnected font-bold text-base"
            style="color: #cc241d"
          >
            Closed
          </div>
        </div>
        <div class="status-item flex flex-col items-center min-w-[120px]">
          <div class="status-label text-sm opacity-80 mb-1">Selected Peer</div>
          <div
            id="selected-peer"
            class="status-value font-bold text-base"
            style="color: #d79921"
          >
            None
          </div>
        </div>
      </div>

      <!-- Main Content -->
      <div class="main-content m-3 flex flex-col lg:flex-row gap-4 md:gap-6">
        <!-- Side Panel -->
        <div
          class="panel rounded-lg p-4 md:p-6 shadow-lg flex-1 lg:min-w-[350px]"
          id="side-panel"
          style="background: #1d2021; color: #ebdbb2; border: 1px solid #504945"
        >
          <h2 class="text-xl md:text-2xl mb-4 pb-3 border-b border-[#504945]">
            Available Peers
          </h2>

          <ul
            id="peers-list"
            class="peers-list min-h-[300px] grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-3 xl:grid-cols-4 gap-3 md:gap-4 md:min-h-[300px] overflow-y-auto justify-items-center content-start p-2 md:p-4"
          ></ul>

          <div class="action-buttons flex gap-2 md:gap-3 mt-4 md:mt-6">
            <button
              id="call-btn"
              class="btn cursor-pointer btn-success flex-1 px-4 py-2.5 md:px-5 md:py-3 rounded-lg font-bold transition-all disabled:bg-[#7c6f64] disabled:cursor-not-allowed text-sm md:text-base"
              style="background: #689d6a; color: #282828"
              disabled
            >
              Connect
            </button>
          </div>

          <div
            class="flex flex-col sm:flex-row justify-center items-stretch sm:items-center gap-3 my-4 md:my-6"
          >
            <label
              for="fileShare"
              class="file-input-label inline-block px-4 py-2.5 rounded-md border border-dashed cursor-pointer transition-all text-center text-sm md:text-base"
              id="file-input-label"
              style="color: #8ec07c; border-color: #458588"
            >
              📎 choose files to send...
            </label>
            <input
              type="file"
              name="fileShare"
              id="fileShare"
              class="file-input"
              multiple
            />
            <button
              type="button"
              class="btn cursor-pointer btn-primary px-4 py-2.5 rounded-lg font-bold transition-all text-sm md:text-base"
              id="send-file-btn"
              style="background: #458588; color: #282828"
            >
              send
            </button>
          </div>

          <div
            id="file-progress"
            class="min-h-[1.4em] mt-2 text-xs md:text-sm text-[#a89984] px-1"
          ></div>
        </div>

        <!-- Message Panel -->
        <div
          class="panel rounded-lg p-4 md:p-6 shadow-lg flex-1"
          style="background: #1d2021; color: #ebdbb2; border: 1px solid #504945"
        >
          <h2 class="text-xl md:text-2xl mb-4 pb-3 border-b border-[#504945]">
            connection log
          </h2>

          <div
            id="message-log"
            class="message-log bg-[#1d2021] rounded-lg p-3 md:p-4 h-[250px] md:h-[300px] overflow-y-auto font-mono text-xs md:text-sm"
          >
            <div class="log-entry mb-2 pb-2 border-b border-[#504945]">
              <span class="log-time text-[#a89984] text-xs">[00:00:00]</span>
              <span class="log-info" style="color: #689d6a"
                >Application Started.</span
              >
            </div>
          </div>

          <div
            class="message-input flex gap-3 md:gap-4 mt-4"
            style="background: #3c3836"
          >
            <input
              type="text"
              id="message-input"
              placeholder="Type a message to send..."
              class="flex-1 px-3 bg-[#3c3836] py-2 md:px-4 md:py-2.5 rounded-lg border-none text-sm md:text-base placeholder-[#7c6f64] focus:outline-none focus:ring-2 focus:ring-[#b8bb26] text-[#ebdbb2]"
              disabled
            />
            <button
              id="send-btn"
              class="px-4 cursor-pointer py-2 md:px-5 md:py-2.5 rounded-lg font-bold text-sm md:text-base"
              style="background: #458588; color: #282828"
              disabled
            >
              send
            </button>
          </div>
        </div>
      </div>
    </div>
    <script src="client.js" type="module"></script>
    <script>
      if ("serviceWorker" in navigator) {
        window.addEventListener("load", () => {
          navigator.serviceWorker
            .register("/sw.js")
            .then((reg) => console.log("Service Worker registered:", reg))
            .catch((err) =>
              console.warn("Service Worker registration failed:", err),
            );
        });
      }
    </script>
  </body>
</html>
