<!doctype html>
<html lang="en">
  <head>
    <link rel="manifest" href="/site.webmanifest" />
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="theme-color" content="#282828" />
    <title>PeerShare</title>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <link
      rel="icon"
      type="image/png"
      sizes="32x32"
      href="/public/favicon-32x32.png"
    />
    <link rel="apple-touch-icon" type="" href="/public/apple-touch-icon.png" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta
      name="apple-mobile-web-app-status-bar-style"
      content="black-translucent"
    />
    <style>
      @layer base {
        * {
          box-sizing: border-box;
          margin: 0;
          padding: 0;
          font-family:
            monospace,
            -apple-system,
            system-ui,
            blinkmacsystemfont,
            "segoe ui",
            roboto,
            oxygen,
            ubuntu,
            cantarell,
            "open sans",
            "helvetica neue",
            sans-serif;
        }
      }

      .file-input {
        position: absolute;
        width: 1px;
        height: 1px;
        padding: 0;
        margin: -1px;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        white-space: nowrap;
        border: 0;
      }

      .animate-bounce-2 {
        animation: bounce 1s ease-in infinite;
        animation-iteration-count: 2;
      }

      @keyframes bounce {
        0%,
        100% {
          transform: translateY(-0%);
        }
        50% {
          transform: translateY(-10px);
        }
      }

      @keyframes sonar {
        0% {
          transform: scale(0.35);
          opacity: 0.8;
        }

        100% {
          transform: scale(2.4);
          opacity: 0;
        }
      }

      @keyframes float {
        0%,
        100% {
          transform: translateY(0);
        }

        50% {
          transform: translateY(-5px);
        }
      }

      @keyframes pop {
        0% {
          transform: scale(0.5);
          opacity: 0;
        }

        70% {
          transform: scale(1.08);
        }

        100% {
          transform: scale(1);
          opacity: 1;
        }
      }

      .peer-item:hover {
        transform: scale(1.05);
      }

      .peer-item {
        width: 80px;
        height: 80px;
        border-radius: 50%;
        background: #458588;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        text-align: center;
        padding: 8px;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
        cursor: pointer;
        transition: all 0.2s ease;
        overflow: hidden;
        outline: 2px dashed #d79921;
        outline-offset: 6px;

        position: relative;
        overflow: hidden;
        animation:
          float 3s ease-in-out infinite,
          pop 0.6s ease-out backwards;
      }

      .peer-name,
      .peer-id {
        font-size: 0.65rem;
        line-height: 1.2;
        color: white;
        width: 100%;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
      }

      .peer-item::before {
        content: "";
        position: absolute;
        inset: 0;
        border-radius: 50%;
        border: 2px solid #d79921;
        animation: sonar 2.2s ease-out infinite;
      }

      .peer-item.selected {
        animation-duration: 0.8s, 0.6s;
      }

      .peer-item:hover::before {
        animation-play-state: paused;
      }

      @keyframes dot {
        0%,
        20% {
          opacity: 0;
        }
        50% {
          opacity: 1;
        }
        100% {
          opacity: 0;
        }
      }

      .peers-list.empty-state .message::after {
        content: "";
        display: inline-block;
        width: 6px;
        height: 6px;
        margin-left: 6px;
        background: #d79921;
        border-radius: 50%;
        animation: dot 1.4s infinite;
      }

      @media (min-width: 640px) {
        .peer-item {
          width: 90px;
          height: 90px;
          outline-offset: 7px;
        }
      }

      @media (min-width: 768px) {
        .peer-item {
          width: 100px;
          height: 100px;
          outline-offset: 8px;
        }
      }

      @media (min-width: 768px) {
        .peer-name,
        .peer-id {
          font-size: 0.75rem;
        }
      }

      .peer-name {
        font-weight: bold;
        margin-bottom: 2px;
      }

      .peer-item:hover {
        outline: 2px solid #d79921;
        background: #076678;
      }

      .peer-item.selected {
        background: rgba(76, 175, 80, 0.4);
        border: 2px solid #4caf50;
        transform: scale(1.05);
      }

      .peers-list.empty-state {
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
      }

      .peers-list.empty-state .message {
        color: #aaa;
        font-style: italic;
        text-align: center;
        padding: 20px;
      }

      .file-input-label:hover {
        background: black;
        border-color: #3c7d7f;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      }

      #status-bar {
        background: #282828;
      }

      .status-value.connected {
        color: #98971a !important;
      }

      .status-value.disconnected {
        color: #cc214d !important;
      }

      .log-warning {
        color: #ff9800;
      }

      .log-error {
        color: #f44336;
      }
    </style>
  </head>

  <body class="bg-[#282828] text-white min-h-screen p-4 md:p-6 lg:p-8">
    <div
      id="notify"
      class="hidden text-[#83a598] absolute bg-[#282828] animate-bounce-2 top-5 left-5 border-2 border-solid border-[#cc241d] p-2"
    >
      <span class="text-[#cc241d]">‚óè </span>Starting up... This may take a few
      seconds on first launch.
    </div>
    <div
      id="share-modal"
      class="hidden fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-4"
    >
      <div
        class="bg-[#282828] border border-[#3c3836] rounded-lg p-6 w-full max-w-md mx-4"
      >
        <div class="flex justify-center my-4">
          <div
            id="qr-code"
            class="bg-[#3c3836] border border-[#504945] w-48 h-48 flex items-center justify-center"
          ></div>
        </div>

        <div class="mt-4">
          <label class="block text-[#a89984] text-sm mb-1">Room ID</label>
          <div
            id="room-id"
            class="text-[#ebdbb2] bg-[#3c3836] p-2 rounded font-mono text-center break-all text-sm"
          ></div>
        </div>

        <div class="mt-5">
          <button
            id="copy-url-btn"
            class="w-full bg-[#3c3836] hover:bg-[#504945] text-[#83a598] py-2 rounded text-sm font-medium transition focus:outline-none focus:ring-1 focus:ring-[#83a598]"
          >
            Copy Room URL
          </button>
        </div>
      </div>
    </div>

    <div
      id="join-room"
      class="min-h-screen text-[#ebdbb2] flex items-center justify-center p-6"
    >
      <div
        class="w-full max-w-4xl grid md:grid-cols-2 gap-0 rounded-xl shadow-2xl bg-[#3c3836] border border-[#504945] overflow-hidden"
      >
        <!-- LEFT: private / internet room -->
        <div class="p-8 space-y-6 border-r border-[#504945]">
          <div class="text-center">
            <h2 class="text-2xl font-bold text-[#fabd2f]">Private room</h2>
            <p class="text-sm text-[#a89984] mt-1">
              Works across Wi-Fi, mobile, VPN
            </p>
          </div>

          <button
            id="create-btn"
            class="cursor-pointer w-full flex items-center justify-center gap-3 bg-[#fe8019] hover:bg-[#fd9644] text-[#282828] font-semibold py-3 px-4 rounded-lg transition transform hover:scale-[1.02] focus:outline-none focus:ring-4 focus:ring-[#fe8019]/50"
          >
            <svg
              class="w-6 h-6"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                d="M12 4v16m8-8H4"
              />
            </svg>
            Create room
          </button>

          <div
            class="flex items-center text-[#7c6f64] text-xs uppercase tracking-wider"
          >
            <span class="h-px bg-[#504945] flex-1"></span
            ><span class="px-3">or</span
            ><span class="h-px bg-[#504945] flex-1"></span>
          </div>

          <form id="join-private-form" class="space-y-3">
            <label
              for="roomCode"
              class="block text-sm font-medium text-[#b8bb26]"
              >Already have a code?</label
            >
            <input
              id="roomCode"
              type="text"
              placeholder="a8f3k2"
              maxlength="8"
              class="w-full bg-[#282828] border border-[#504945] rounded-md px-4 py-2 text-[#ebdbb2] placeholder-[#7c6f64] focus:outline-none focus:ring-2 focus:ring-[#b8bb26]"
            />
            <button
              type="submit"
              id="join-btn"
              class="cursor-pointer w-full bg-[#458588] hover:bg-[#83a598] text-[#282828] font-semibold px-5 py-2.5 rounded-md transition"
            >
              Join
            </button>
          </form>
        </div>

        <!-- RIGHT: LAN-only room -->
        <div class="p-8 space-y-6 bg-[#1d2021]">
          <div class="text-center">
            <h2 class="text-2xl font-bold text-[#b8bb26]">LAN room</h2>
            <p class="text-sm text-[#a89984] mt-1">
              Same Wi-Fi ‚Üí zero config, fastest speed
            </p>
          </div>

          <button
            id="lan-btn"
            class="cursor-pointer w-full flex items-center justify-center gap-3 bg-green-700 hover:bg-green-600 text-[#282828] font-semibold py-3 px-4 rounded-lg transition transform hover:scale-[1.02] focus:outline-none focus:ring-4 focus:ring-green-500/50"
          >
            <svg
              class="w-6 h-6"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                d="M13 10V3L4 14h7v7l9-11h-7z"
              />
            </svg>
            Start LAN room
          </button>

          <div class="mt-6 text-xs text-[#7c6f64] text-center">
            Unable to discover local devices?
            <span class="block mt-1"
              >You can always switch to private room</span
            >
          </div>
        </div>
      </div>
    </div>

    <div
      id="main-ui"
      class="container hidden max-w-7xl mx-auto flex flex-col gap-4 md:gap-6"
    >
      <button
        id="share-btn"
        class="fixed bottom-5 right-5 bg-[#3c3836] hover:bg-[#504945] text-yellow-500 p-3 rounded text-sm font-medium transition shadow-[0_2px_4px_rgba(0,0,0,0.2)] focus:outline-none focus:ring-1 focus:ring-[#83a598]"
      >
        üîó share room
      </button>

      <header class="text-center py-6 md:py-8 lg:py-10 px-4">
        <h1
          class="text-3xl md:text-4xl lg:text-5xl font-medium tracking-tight mb-2 md:mb-3"
          style="color: #b8bb26; text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2)"
        >
          peer-to-peer connection.
        </h1>
        <p
          class="text-sm md:text-base lg:text-lg font-light tracking-wide opacity-80"
          style="color: #8ec07c"
        >
          file & message share, directly
        </p>
      </header>

      <!-- Status Bar -->
      <div
        id="status-bar"
        class="status-bar md:hidden grid grid-cols-2 gap-3 text-[#ebdbb2] p-3 rounded-lg shadow-lg text-lg"
        style="background: #3c3836"
      >
        <div class="status-item text-center">
          <div class="status-label opacity-70">Status</div>
          <div id="status-m" class="status-value disconnected font-semibold">
            ‚óè
          </div>
        </div>
        <div class="status-item text-center">
          <div class="status-label opacity-70">ID</div>
          <div class="my-id status-value font-semibold">-</div>
        </div>
      </div>
      <div
        class="status-bar hidden bg-[#3c3836] md:flex flex-wrap m-auto justify-between w-fit gap-8 text-[#ebdbb2] p-8 rounded-lg shadow-lg"
      >
        <div class="status-item flex flex-col items-center">
          <div
            id="status"
            class="status-value disconnected font-bold text-base"
            style="color: #cc241d"
          >
            Offline
          </div>
        </div>
        <p>|</p>
        <div class="status-item flex flex-col items-center min-w-[120px]">
          <div
            id="your-device"
            class="status-value font-bold text-base"
            style="color: #d79921"
          >
            Not registered
          </div>
        </div>
        <p>|</p>
        <div class="status-item flex flex-col items-center min-w-[120px]">
          <div
            id="selected-peer"
            class="status-value text-[#cc214d] font-bold text-base"
          >
            Not Connected
          </div>
        </div>
      </div>

      <!-- Main Content -->
      <div class="main-content m-3 flex flex-col lg:flex-row gap-4 md:gap-6">
        <!-- Side Panel -->
        <div
          class="panel rounded-lg p-4 md:p-10 flex flex-col gap-4 shadow-lg flex-1 bg-[#1d2021] text-[#ebdbb2] lg:min-w-[350px]"
          id="side-panel"
        >
          <div id="list-peers" class="hidden">
            <h2 class="text-xl md:text-2xl mb-4 pb-3 border-b border-[#504945]">
              Available Peers
            </h2>

            <ul
              id="peers-list"
              class="peers-list min-h-[300px] grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-3 xl:grid-cols-4 gap-3 md:gap-4 md:min-h-[300px] overflow-y-auto justify-items-center content-start p-2 md:p-4"
            ></ul>

            <div class="action-buttons flex gap-2 md:gap-3 mt-4 md:mt-6">
              <button
                id="call-btn"
                class="btn cursor-pointer btn-success flex-1 px-4 py-2.5 md:px-5 md:py-3 rounded-lg font-bold transition-all disabled:bg-[#7c6f64] disabled:cursor-not-allowed text-sm md:text-base"
                style="background: #689d6a; color: #282828"
                disabled
              >
                Connect
              </button>
            </div>
          </div>

          <div
            id="file-select-only"
            class="flex flex-col md:flex-row justify-center items-stretch md:items-center gap-4"
          >
            <label
              for="fileShare"
              id="file-input-label"
              class="file-input-label px-8 py-4 rounded-md border border-solid cursor-pointer transition-all text-center text-sm md:text-base"
            >
              üìé choose files
            </label>
            <input
              type="file"
              name="fileShare"
              id="fileShare"
              class="file-input"
              multiple
            />
            <button
              type="button"
              class="btn cursor-pointer btn-primary px-8 py-4 rounded-lg font-bold transition-all text-sm md:text-base"
              id="send-file-btn"
              style="background: #458588; color: #282828"
            >
              send
            </button>
          </div>
          <p
            id="file-hint"
            class="flex justify-center items-center text-xs p-6 text-[#a89984]"
          >
            Add files first ‚Äì nearby devices will appear automatically
          </p>

          <div id="file-prog-div" class="w-[60%] mx-auto hidden">
            <div class="flex justify-between mb-1">
              <span class="text-sm font-medium text-[#ebdbb2]">Progress</span>
              <span
                id="progress-text"
                class="text-sm font-medium text-[#ebdbb2]"
                >0%</span
              >
            </div>

            <div class="w-full h-2 rounded-full bg-[#3c3836] overflow-hidden">
              <div
                id="progress-fill"
                class="h-full rounded-full bg-[#b8860b] transition-all duration-300 ease-out"
                style="width: 0%"
              ></div>
            </div>
          </div>
        </div>

        <!-- Message Panel -->
        <div
          class="panel bg-[#1d2021] text-[#ebdbb2] rounded-lg p-4 md:p-10 shadow-lg flex-1"
        >
          <h2 class="text-xl md:text-2xl mb-4 pb-3 border-b border-[#504945]">
            chat / connection log
          </h2>

          <div
            id="message-log"
            class="message-log bg-[#1d2021] rounded-lg p-3 md:p-4 h-[250px] md:h-[300px] overflow-y-auto font-mono text-xs md:text-sm"
          >
            <div class="log-entry mb-2 pb-2 border-b border-[#504945]">
              <span class="log-time text-[#a89984] text-xs">[00:00:00]</span>
              <span class="log-info" style="color: #689d6a"
                >Application Started.</span
              >
            </div>
          </div>

          <div
            class="message-input bg-[#3c3836] rounded-lg flex flex-col md:flex-row md:gap-4 mt-4"
          >
            <input
              type="text"
              id="message-input"
              placeholder="Type a message to send..."
              class="flex-1 px-3 bg-[#3c3836] py-2 md:px-4 md:py-2.5 rounded-lg border-none text-sm md:text-base placeholder-[#7c6f64] focus:outline-none focus:ring-2 focus:ring-[#b8bb26] text-[#ebdbb2]"
              disabled
            />
            <button
              id="send-btn"
              class="px-4 cursor-pointer py-2 md:px-5 md:py-2.5 m-4 rounded-lg font-bold text-sm md:text-base"
              style="background: #458588; color: #282828"
              disabled
            >
              send
            </button>
          </div>
        </div>
      </div>
      <footer class="mt-auto w-full py-4 text-center text-xs text-[#a89984]">
        <a
          href="https://github.com/Akhil373/webrtc-share"
          target="_blank"
          rel="noopener noreferrer"
          class="inline-flex items-center gap-2 hover:text-[#ebdbb2] transition"
        >
          <svg
            class="w-3 h-3 fill-current"
            viewBox="0 0 16 16"
            aria-hidden="true"
          >
            <path
              d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38
               0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01
               1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95
               0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0
               1.38.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15
               0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.01 8.01 0 0 0 16 8c0-4.42-3.58-8-8-8z"
            />
          </svg>
          GitHub
        </a>
      </footer>
    </div>
    <script src="js/main.js" type="module"></script>
    <script>
      if ("serviceWorker" in navigator) {
        window.addEventListener("load", () => {
          navigator.serviceWorker
            .register("/sw.js")
            .then((reg) => console.log("Service Worker registered:", reg))
            .catch((err) =>
              console.warn("Service Worker registration failed:", err),
            );
        });
      }
    </script>
  </body>
</html>
